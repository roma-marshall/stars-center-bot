import TelegramBot from "node-telegram-bot-api";
import dotenv from "dotenv";

dotenv.config();

const bot = new TelegramBot(process.env.BOT_TOKEN, { polling: true });

/* ---------------------------------------------
   /start ‚Äî –ø—Ä–∏–≤–µ—Ç + –º–µ–Ω—é
---------------------------------------------- */
bot.onText(/\/start/, (msg) => {
  bot.sendMessage(
    msg.chat.id,
    "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Stars Center!\n\n" +
    "–≠—Ç–æ—Ç –±–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ø—Ä–æ—Ñ–∏–ª—å –∏ –±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.",
    {
      reply_markup: {
        inline_keyboard: [
          [
            { text: "–ü—Ä–æ—Ñ–∏–ª—å", callback_data: "profile" },
            { text: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", callback_data: "info" }
          ],
          [
            { text: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã", callback_data: "tools" }
          ],
          [
            { text: "–ü–æ–º–æ—â—å", callback_data: "help" }
          ]
        ]
      }
    }
  );
});

/* ---------------------------------------------
   –ü–û–ö–ê–ó –ü–†–û–§–ò–õ–Ø
---------------------------------------------- */
bot.on("callback_query", (query) => {
  const user = query.from;
  const chatId = query.message.chat.id;

  if (query.data === "profile") {
    bot.answerCallbackQuery(query.id);
    bot.sendMessage(
      chatId,
      `üìÑ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:\n\n` +
      `‚Ä¢ Username: @${user.username || "–Ω–µ—Ç"}\n` +
      `‚Ä¢ ID: ${user.id}\n` +
      `‚Ä¢ –ò–º—è: ${user.first_name || "–Ω–µ—Ç"}\n` +
      `‚Ä¢ –Ø–∑—ã–∫: ${user.language_code || "–Ω–µ—Ç"}`
    );
  }

  /* ---------------------------------------------
     –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  ---------------------------------------------- */
  if (query.data === "info") {
    bot.answerCallbackQuery(query.id);
    bot.sendMessage(
      chatId,
      "‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Stars:\n\n" +
      "Stars ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤–∞–ª—é—Ç–∞ Telegram Mini Apps.\n" +
      "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤, —Å—Ç–∏–∫–µ—Ä–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–π.\n\n" +
      "–≠—Ç–æ—Ç –±–æ—Ç —è–≤–ª—è–µ—Ç—Å—è —Å–ø—Ä–∞–≤–æ—á–Ω—ã–º —Ü–µ–Ω—Ç—Ä–æ–º."
    );
  }

  /* ---------------------------------------------
     –ò–ù–°–¢–†–£–ú–ï–ù–¢–´
  ---------------------------------------------- */
  if (query.data === "tools") {
    bot.answerCallbackQuery(query.id);
    bot.sendMessage(
      chatId,
      "üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã Stars:\n\n" +
      "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è\n" +
      "‚Ä¢ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n" +
      "‚Ä¢ –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã"
    );
  }

  /* ---------------------------------------------
     –ü–û–ú–û–©–¨ / HELP
  ---------------------------------------------- */
  if (query.data === "help") {
    bot.answerCallbackQuery(query.id);
    bot.sendMessage(
      chatId,
      "üÜò –†–∞–∑–¥–µ–ª –ø–æ–º–æ—â–∏:\n\n" +
      "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n" +
      "‚Ä¢ /start ‚Äî –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n" +
      "‚Ä¢ /profile ‚Äî –ü—Ä–æ—Ñ–∏–ª—å (—á–µ—Ä–µ–∑ –º–µ–Ω—é)\n" +
      "‚Ä¢ /info ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—á–µ—Ä–µ–∑ –º–µ–Ω—é)\n" +
      "‚Ä¢ /tools ‚Äî –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (—á–µ—Ä–µ–∑ –º–µ–Ω—é)\n\n" +
      "–≠—Ç–æ—Ç –±–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Stars."
    );
  }
});

/* ---------------------------------------------
   FALLBACK ‚Äî –µ—Å–ª–∏ —é–∑–µ—Ä –ø–∏—à–µ—Ç —á—Ç–æ-—Ç–æ
---------------------------------------------- */
bot.on("message", (msg) => {
  if (!msg.text.startsWith("/")) {
    bot.sendMessage(msg.chat.id, "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –º–µ–Ω—é.");
  }
});
